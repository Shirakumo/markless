\lstdefinestyle{codestyle}{
  basicstyle=\ttfamily,
  columns=flexible,
  keepspaces=true,
  breaklines=true,
  breakatwhitespace=true,
  escapeinside={\$}{\$}
}
\def\inline{\lstinline[style=codestyle]}

\hypersetup{
  colorlinks,
  linkcolor={black},
  citecolor={blue!50!black},
  urlcolor={blue!80!black}
}

\newlist{step}{enumerate}{10}
\setlist[step]{label*=\arabic*.,leftmargin=2em}

\renewcommand{\labelenumii}{\theenumii}
\renewcommand{\theenumii}{\theenumi.\arabic{enumii}.}

\newcommand{\warn}[1]{
  \begin{tcolorbox}[width=\textwidth,colback={red},boxrule=0pt,arc=0mm,fontupper=\bfseries,colupper=white]%
    \begin{center}%
      {\Large #1}%
    \end{center}%
  \end{tcolorbox}%
}

\newcommand{\multilinecell}[2][l]{
  \begin{tabular}{@{}#1@{}}%
    #2%
  \end{tabular}%
}

\newcommand{\unicode}[1]{%
  \char"#1{} (\inline$U+#1$)%
}

\newcommand{\symbolref}[1]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \hyperref[symbol:#1]{\expandafter\inline\expandafter{\WORD}}%
}

\newcommand{\definesymbol}[1]{%
  \inline$#1$\label{symbol:#1}%
}

\newcommand{\definesyntax}[1]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \inline$#1$\label{syntax:\WORD}%
}

\newcommand{\syntax}[1]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \hyperref[syntax:\WORD]{\inline$#1$}%
}

\newcommand{\defineidentifier}[2]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \makebox[\textwidth][l]{%
    \textit{Identifier} %
    \textbf{\capitalisewords{#1}}: %
    \multilinecell{\inline$#2$}%
  }%
  \label{identifier:\WORD}%
}

\lstnewenvironment{identifier}[1]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \label{identifier:\WORD}
  \textit{Identifier} %
  \textbf{\capitalisewords{#1}}: %
  \lstset{basicstyle=\ttfamily}%
}{
}

\newcommand{\ident}[1]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \hyperref[identifier:\WORD]{\textit{#1}}%
}

\newcommand{\definestyle}[2]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \makebox[\textwidth][l]{%
    \textit{Style} %
    \textbf{\capitalisewords{#1}}: %
    \inline$#2$%
  }%
  \label{style:\WORD}%
}

\newcommand{\style}[1]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \hyperref[style:\WORD]{\textit{#1}}%
}

\newcommand{\definetextualcomponent}[2]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \makebox[\textwidth][l]{%
    \textit{Textual Component} %
    \textbf{\capitalisewords{#1}}: %
    \inline$#2$%
  }%
  \label{textualcomponent:\WORD}%
  \label{style:\WORD}%
}

\newcommand{\comp}[1]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \hyperref[textualcomponent:\WORD]{\textit{#1}}%
}

\newcommand{\defineinstruction}[2]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \makebox[\textwidth][l]{%
    \textit{Instruction} %
    \textbf{\capitalisewords{#1}}: %
    \multilinecell{\inline$#2$}%
  }%
  \label{instruction:\WORD}%
}

\lstnewenvironment{instruction}[1]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \label{instruction:\WORD}
  \textit{Instruction} %
  \textbf{\capitalisewords{#1}}: %
  \lstset{basicstyle=\ttfamily}%
}{
}

\newcommand{\instr}[1]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \hyperref[instruction:\WORD]{\textit{#1}}%
}

\newcommand{\definevariable}[2]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \makebox[\textwidth][l]{%
    \textit{Variable} %
    \textbf{#1}: %
    \multilinecell{\inline$#2$}%
  }%
  \label{variable:\WORD}%
}

\lstnewenvironment{variable}[1]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \label{variable:\WORD}
  \textit{Variable} %
  \textbf{#1}: %
  \lstset{basicstyle=\ttfamily}%
}{
}

\newcommand{\var}[1]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \hyperref[variable:\WORD]{\textit{#1}}%
}

\setcounter{secnumdepth}{6}
\setcounter{tocdepth}{6}

\newcommand{\definesection}[1]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \newpage\section{#1}\label{section:\WORD}%
}

\newcommand{\definesubsection}[1]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \subsection{#1}\label{section:\WORD}%
}

\newcommand{\definesubsubsection}[1]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \subsubsection{#1}\label{section:\WORD}%
}

\newcommand{\definesubsubsubsection}[1]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \paragraph{#1}\label{section:\WORD}\mbox{}\\%
}

\newcommand{\definesubsubsubsubsection}[1]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \subparagraph{#1}\label{section:\WORD}\mbox{}\\%
}

\newcommand{\sectionref}[1]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \hyperref[section:\WORD]{\textit{#1}}%
}

\newcommand{\defineglossary}[2]{%
  \StrSubstitute{#1}{ }{}[\stripped]%
  \newglossaryentry{\stripped}{%
    name={\capitalisewords{#1}},%
    text={#1},%
    description={#2},%
    sort={#1}%
  }%
}

\newcommand{\defineissue}[1]{%
  \let\WORD\undefined%
  \MakeUppercase{\gdef\noexpand\WORD{#1}}%
  \subsection*{#1}\label{issue:\WORD}%
  \lstinputlisting[breaklines=true,basicstyle=\small\ttfamily,breakindent=0cm]{"#1"}%
}

\newenvironment{examples}{%
  \par
  \begin{minipage}{\textwidth}
  {\bfseries\large Examples:} \\
  \renewcommand{\arraystretch}{1.3}%
  \begin{tabular}{lcl}
}{%
  \end{tabular}
  \renewcommand{\arraystretch}{1}%
  \end{minipage}
  \par%
}

\newcommand{\example}[2]{%
  \inline$#1$ &$\Rightarrow$& \multilinecell{#2} \\
}

\lstnewenvironment{examplesource}{\lstset{style=codestyle}}{}

\NewEnviron{exampleoutput}{
  \toks0=\expandafter{\BODY}%
  \toks2={&$\Rightarrow$&}%
  \xdef\TableRowContents{\the\toks2 \noexpand\multilinecell{\the\toks0}\noexpand\\}%
  \aftergroup\TableRowContents
}

\newcommand{\longexample}[2]{%
  \multicolumn{3}{l}{%
    \multilinecell{%
      \inline$#1$ \\%
      \hspace*{1em}$\Rightarrow$ #2%
    }%
  } \\%
}

\NewEnviron{blockquote}[1][]{%
  \begin{minipage}{0.3\textwidth}%
    {\itshape\BODY}%
    \ifx\relax#1\relax%
    \else%
    \vspace{-0.2cm}\begin{flushright}--- #1\end{flushright}%
    \fi%
  \end{minipage}%
}

\providecommand{\g}{}
\renewcommand{\g}[1]{%
  \StrSubstitute{#1}{ }{}[\stripped]%
  \textit{\gls{\stripped}}%
}

\providecommand{\G}{}
\renewcommand{\G}[1]{%
  \StrSubstitute{#1}{ }{}[\stripped]%
  \textit{\Gls{\stripped}}%
}

\providecommand{\gpl}{}
\renewcommand{\gpl}[1]{%
  \StrSubstitute{#1}{ }{}[\stripped]%
  \textit{\glspl{\stripped}}%
}

\providecommand{\Gpl}{}
\renewcommand{\Gpl}[1]{%
  \StrSubstitute{#1}{ }{}[\stripped]%
  \textit{\Glspl{\stripped}}%
}

\providecommand{\glink}{}
\renewcommand{\glink}[2]{%
  \StrSubstitute{#1}{ }{}[\stripped]%
  \textit{\glslink{\stripped}{#2}}%
}

\def\gittag{\directlua{dofile("git-tag.lua")}}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "markless"
%%% TeX-engine: luatex
%%% TeX-command-extra-options: "-shell-escape"
%%% End:
